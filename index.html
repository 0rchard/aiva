<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/kengz/aiva'>AIVA Github</a></li>
            <li><a href='https://github.com/kengz/aiva-doc'>AIVA documentation Github</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="aiva">AIVA <a href="https://travis-ci.org/kengz/aiva"><img alt="Build Status" src="https://travis-ci.org/kengz/aiva.svg?branch=aiva-v3" /></a> <a href="https://coveralls.io/github/kengz/aiva?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/kengz/aiva/badge.svg?branch=aiva-v3" /></a> <a href="https://gemnasium.com/kengz/jarvis"><img alt="Dependency Status" src="https://gemnasium.com/kengz/jarvis.svg" /></a></h1>

<aside class="warning">
This documentation is still being completed.
</aside>

<p><strong>AIVA</strong> (A.I. Virtual Assistant): General-purpose virtual assistant for developers. </p>

<table><thead>
<tr>
<th style="text-align: left">AIVA is</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">general-purpose</td>
<td>An app interface, AI assistant, anything!</td>
</tr>
<tr>
<td style="text-align: left">cross-platform</td>
<td>Slack, Telegram, Facebook, IRC, Twilio, or any <a href="https://github.com/github/hubot/blob/master/docs/adapters.md">hubot adapters</a></td>
</tr>
<tr>
<td style="text-align: left">multi-language</td>
<td>Run and pass data among Node.js, Python3, Ruby, etc.</td>
</tr>
<tr>
<td style="text-align: left">built-in AI tools</td>
<td>Tensorflow, skflow, Indico.ml, spaCy, Watson, Google APIs</td>
</tr>
<tr>
<td style="text-align: left">hackable</td>
<td>It extends <a href="https://github.com/github/hubot">Hubot</a>. Add your own modules!</td>
</tr>
<tr>
<td style="text-align: left">powerful, easy to use</td>
<td>Check out <a href="#setup">setup</a> and <a href="#features">features</a></td>
</tr>
</tbody></table>

<p>AIVA is based on a theoretical interface <a href="https://github.com/kengz/aiva/tree/aiva-v3/docs/HTMI.md">HTMI</a> and a brain <a href="https://github.com/kengz/aiva/tree/aiva-v3/docs/CGKB.md">CGKB</a> that is <em>human-bounded Turing complete</em>. The theorem establishes that HTMI can be used by a human to solve any problems or perform any functions she enumerates that are solvable by a Turing Machine. Complete implementation is still underway.</p>

<h2 id="installation">Installation</h2>

<p>Clone this repo:</p>
<pre class="highlight shell"><code>git clone https://github.com/kengz/aiva.git
</code></pre>

<p>Use <strong>Ubuntu &gt;14.04</strong> or <strong>MacOSX</strong>; For the fastest VM setup, I recommend <a href="https://www.digitalocean.com">Digital Ocean</a>, with this automatic <a href="https://github.com/kengz/mac_setup">setup script</a>. Optionally for manual setup, see <a href="#dependencies">Dependencies</a>.</p>

<h2 id="setup-run"><a name="setup"></a>Setup, Run</h2>

<h3 id="one-time-setup"><a name="one-time-setup"></a>One-time Setup</h3>

<ul>
<li><strong>install dependencies</strong>: </li>
</ul>
<pre class="highlight shell"><code>npm run gi
</code></pre>

<ul>
<li><strong>setup keys</strong>: update <code class="prettyprint">.env</code>, <code class="prettyprint">bin/.key-aiva</code> (production), <code class="prettyprint">bin/.key-aivadev</code> (development).</li>
</ul>

<p>Check <a href="#setup-tips"><strong>Setup tips</strong></a> for more help.</p>

<aside class="notice">
If you prefer a different bot name, replace &ldquo;aiva&rdquo; from the <code>bin/.keys-</code> and in <code>package.json</code>.
</aside>

<h3 id="run"><a name="run"></a>Run</h3>

<ul>
<li><strong>run</strong>: <code class="prettyprint">npm start</code>; append <code class="prettyprint">--bot=&lt;bot-name&gt;</code> to run the non-default bots.</li>
</ul>
<pre class="highlight shell"><code><span class="c"># alternative commands</span>
forever list <span class="c"># see the list of bots running</span>
npm stop <span class="c"># stop all bots</span>
npm run debug <span class="c"># run aivadev, log to terminal</span>
npm run debug --bot<span class="o">=</span>aiva <span class="c"># debug aiva</span>
npm run shell <span class="c"># fast dev, run aivadev with shell-adapter</span>
npm <span class="nb">test</span> <span class="c"># run unit tests</span>
</code></pre>

<p>The default hubot adapter is Slack. See <a href="#adapters"><strong>Adapters</strong></a> for connecting to different chat platforms.</p>

          <h1 id="development-guide"><a name="dev-guide"></a>Development Guide</h1>

<p>AIVA is created as an A.I. general purpose interface for developers; it has an (pending) ~~NLP interface and KB brain out of the box~~. We take care of the crucial backend and system, so <em>developers can focus on things that matter</em>.</p>

<p>You can focus on writing your app/module backend. When done, plugging it into AIVA shall be way more trivial than writing a whole app with a MEAN stack or Rails.</p>

<h2 id="polyglot-environment"><a name="polyglot"></a>Polyglot Environment</h2>

<p><strong>Unite we stand</strong>. Each language has its strengths, for example Python for machine learning, Node.js for web. With a built in <code class="prettyprint">Socket.io</code> client logic, AIVA allows you to write in multiple coordinating languages.</p>

<p>For now we have <code class="prettyprint">/lib/client.{js, py, rb}</code>. Feel free to add <code class="prettyprint">Socket.io</code> client for more languages through pull request!</p>

<blockquote>
<p>For quick multilingual dev, you can start the <strong>polyglot server</strong> at <code class="prettyprint">lib/io_start</code>.</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># shell: start the polyglot server</span>
node lib/io_start.js
</code></pre>

<aside class="warning">
This is automatically with <code>npm run</code>, so don&rsquo;t manual-run it before starting the bot.
</aside>

<blockquote>
<p>then import a <code class="prettyprint">lib/client.js</code> to test a local feature from the <code class="prettyprint">js</code> interface. Example: quickly testing the translate function in <code class="prettyprint">python</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: interface scripts</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="s2">"hola amigos"</span><span class="p">,</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'ai.py'</span><span class="p">,</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'nlp.translate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// hello friends</span>
</code></pre>

<h2 id="polyglot-development"><a name="polyglot-dev"></a>Polyglot Development</h2>

<p>The quickest way to get into dev is to look at the examples in <code class="prettyprint">lib/&lt;lang&gt;/</code> and <code class="prettyprint">scripts/</code>.</p>

<p>The interface is <code class="prettyprint">js</code>, and it&rsquo;s pretty easy to write. the module can be written in any language if it has a Socket.io client.</p>

<p>Development comes down to:</p>

<ul>
<li><strong>module</strong>: callable low level functions, lives in <code class="prettyprint">/lib/&lt;lang&gt;/&lt;module&gt;.&lt;lang&gt;</code>.</li>
<li><strong>interface</strong>: high level user interface to call the module functions, lives in <code class="prettyprint">/scripts/&lt;interface&gt;.js</code></li>
</ul>

<aside class="notice">
It is vital to follow the <a href="#project-dir">directory structure</a> to expose them to socket.io as it calls from <code>lib/&lt;lang&gt;/*</code> but not deeper. You can import nested modules from there and call it with dot-path. More on this later.
</aside>

<p>You write a module in <code class="prettyprint">&lt;lang&gt;</code>, how do you call it from the interface? There are 3 cases depending on the number of <code class="prettyprint">&lt;lang&gt;</code> (including <code class="prettyprint">js</code> for interface) involved.</p>

<h3 id="case-1-lt-lang-gt">Case: 1 <code class="prettyprint">&lt;lang&gt;</code></h3>

<p><code class="prettyprint">&lt;lang&gt; = js</code>. If your module is in <code class="prettyprint">js</code>, just <code class="prettyprint">require</code> it directly in the interface script.</p>

<aside class="notice">
Since the AIVA is based on hubot, you can refer to <a href="https://github.com/github/hubot/blob/master/docs/scripting.md">hubot scripting guide</a>. You can also <a href="https://github.com/github/hubot/blob/master/docs/scripting.md#script-loading">load hubot scripts</a> written by others.
</aside>

<h3 id="case-2-lt-lang-gt-s">Case: 2 <code class="prettyprint">&lt;lang&gt;</code>s</h3>

<p>e.g. <code class="prettyprint">&lt;lang&gt; = js, py</code>. </p>

<p>1. You write a module <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/hello.py" target="_blank"><code>lib/py/hello.py</code></a></p>

<p>2. Call it from the interface <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a> using the exposed <code class="prettyprint">global.gPass</code> function, with the JSON <code class="prettyprint">msg</code></p>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_py.js</span>
<span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">input</span><span class="p">:</span> <span class="s1">'Hello from user.'</span><span class="p">,</span> <span class="c1">// input for module function</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'hello.py'</span><span class="p">,</span> <span class="c1">// the target module</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'sayHi'</span> <span class="c1">// the module function to call with input</span>
  <span class="c1">// add more as needed</span>
<span class="p">}</span>
</code></pre>

<p>3. Ensure the called module function returns a reply JSON to the interface:</p>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'output'</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'input'</span><span class="p">)),</span> <span class="c"># output to interface</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># is 'client.js' for interface</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="c"># 'hello.py'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span> <span class="c"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<p>The JSON fields above are required for their purposes. <code class="prettyprint">global.gPass</code> used by the interface will auto-inject and <code class="prettyprint">id</code> for reply, and a <code class="prettyprint">hash</code> to resolve the promise for the interface.</p>

<h3 id="case-3-lt-lang-gt-s">Case: 3 <code class="prettyprint">&lt;lang&gt;</code>s</h3>

<p>e.g. <code class="prettyprint">&lt;lang&gt; = js, py, rb</code></p>

<p>1. You write modules in <code class="prettyprint">py, rb</code> <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a>, <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/rb/Hello.rb" target="_blank"><code>lib/rb/Hello.rb</code></a></p>

<p>2. Call one (<code class="prettyprint">py</code> in this example) from the interface <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/hello_py_rb.js" target="_blank"><code>scripts/hello_py_rb.js</code></a> as described earlier.</p>

<p>3. <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a> passes it further to the <code class="prettyprint">rb</code> module, by returning the JSON <code class="prettyprint">msg</code></p>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello_rb.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'input'</span><span class="p">:</span> <span class="s">'Hello from Python from js.'</span><span class="p">,</span> <span class="c"># input for rb module function</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="s">'Hello.rb'</span><span class="p">,</span> <span class="c"># the target module</span>
  <span class="s">'intent'</span><span class="p">:</span> <span class="s">'sayHi'</span><span class="p">,</span> <span class="c"># the module function to call with input</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># pass on 'client.js'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">),</span> <span class="c"># pass on callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<p>4. <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/rb/Hello.rb" target="_blank"><code>lib/rb/Hello.rb</code></a> ensure the final module function returns a reply JSON <code class="prettyprint">msg</code> to the interface. </p>

<aside class="warning">
For auto-id, Ruby filename need to be the same as its module name, case-sensitive.
</aside>
<pre class="highlight ruby"><code><span class="c1"># rb: lib/rb/Hello.rb</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'output'</span> <span class="o">=&gt;</span> <span class="s1">'Hello from Ruby.'</span><span class="p">,</span> <span class="c1"># output to interface</span>
  <span class="s1">'to'</span> <span class="o">=&gt;</span> <span class="n">msg</span><span class="p">[</span><span class="s1">'from'</span><span class="p">],</span> <span class="c1"># 'client.js'</span>
  <span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="vc">@@id</span><span class="p">,</span> <span class="c1"># 'Hello.rb'</span>
  <span class="s1">'hash'</span> <span class="o">=&gt;</span> <span class="n">msg</span><span class="p">[</span><span class="s1">'hash'</span><span class="p">]</span> <span class="c1"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<aside class="notice">
Overall, ensure that your functions return the correct JSON `msg`, and we handle the inter-language dataflow logic. See the <a href="#msg-json"><code>msg</code> JSON keys</a>.
</aside>

<p>With such pattern, you can chain multiple function calls that bounce among different <code class="prettyprint">&lt;lang&gt;</code>. Example use case: retrieve data from Ruby on Rails app, pass to Java to run algorithms, then to Python for data analysis, then back to Node.js interface.</p>

<h3 id="quot-ma-look-no-hand-ler-s-quot">&ldquo;Ma look! No hand(ler)s!&rdquo;</h3>

<p>&ldquo;Do I really have to add a handler to reply a JSON <code class="prettyprint">msg</code> for <strong>every</strong> function I call?&rdquo;. That&rsquo;s really cumbersome. </p>

<p>To streamline polyglot development further we&rsquo;ve made the <code class="prettyprint">client.&lt;lang&gt;</code>&rsquo;s automatically try to compile a proper reply JSON <code class="prettyprint">msg</code>, using the original <code class="prettyprint">msg</code> it receives for invoking a function.</p>

<p>What this means is you can call a <strong>module</strong> (<code class="prettyprint">to</code>) by its name, and its <strong>function</strong> (<code class="prettyprint">intent</code>) by specifying the dotpath (if it&rsquo;s nested), then providing a valid <code class="prettyprint">input</code> format (single argument for now).</p>

<p>On receiving a <code class="prettyprint">msg</code>, the <code class="prettyprint">client.&lt;lang&gt;</code> tries to call the function by passing <code class="prettyprint">msg</code>. If that throws an exception, it retries by passing <code class="prettyprint">msg.input</code>. After the function executes and returns the result, <code class="prettyprint">client.&lt;lang&gt;</code>&rsquo;s handler will check if the reply is a valid JSON, and if not, will make it into one via <code class="prettyprint">correctJSON(reply, msg)</code> by extracting the information needed from the received <code class="prettyprint">msg</code>.</p>

<p>Lastly, after the <code class="prettyprint">js</code> <code class="prettyprint">global.gPass</code> sends out a <code class="prettyprint">msg</code>, the final reply directed at it should contain an <code class="prettyprint">output</code> field, as good dev pattern and reliability in promise-resolution. When <code class="prettyprint">global.gPass(msg)</code> gets its reply and its promise resolved, you will see <code class="prettyprint">hasher.handle invoking cb</code> in stdout.</p>

<aside class="notice">
In fact, once we finish the NLP auto-parsing feature for user sentences, we wouldn&rsquo;t even need to write an interface; Still working on it.
</aside>

<h2 id="unit-tests">Unit Tests</h2>

<p>This repo includes only unit tests for <code class="prettyprint">js</code> <strong>modules</strong> and <strong>interface</strong> scripts using <code class="prettyprint">mocha</code>, and runs with <code class="prettyprint">npm test</code>. Note that tests should be for systems, thus the tests for AI models are excluded.</p>

<p>For the module of other <code class="prettyprint">&lt;lang&gt;</code>, you may add any unit testing framework of your choice.</p>

<h2 id="how-it-works-socket-io-logic-and-standard">How it works: Socket.io logic and standard</h2>

<h3 id="msg-json-keys-for-different-purposes"><a name="msg-json"></a><code class="prettyprint">msg</code> JSON keys for different purposes.</h3>

<ul>
<li>to call a module&rsquo;s function in <code class="prettyprint">&lt;lang&gt;</code>: <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a></li>
</ul>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_py.js</span>
<span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">input</span><span class="p">:</span> <span class="s1">'Hello from user.'</span><span class="p">,</span> <span class="c1">// input for module function</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'hello.py'</span><span class="p">,</span> <span class="c1">// the target module</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'sayHi'</span> <span class="c1">// the module function to call with input</span>
  <span class="c1">// add more as needed</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>to reply the payload to sender: <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/hello.py" target="_blank"><code>lib/py/hello.py</code></a></li>
</ul>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'output'</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'input'</span><span class="p">)),</span> <span class="c"># output to interface</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># is 'client.js' for interface</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="c"># 'hello.py'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span> <span class="c"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>to pass on payload to other module&rsquo;s function: <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a></li>
</ul>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello_rb.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'input'</span><span class="p">:</span> <span class="s">'Hello from Python from js.'</span><span class="p">,</span> <span class="c"># input for rb module function</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="s">'Hello.rb'</span><span class="p">,</span> <span class="c"># the target module</span>
  <span class="s">'intent'</span><span class="p">:</span> <span class="s">'sayHi'</span><span class="p">,</span> <span class="c"># the module function to call with input</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># pass on 'client.js'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">),</span> <span class="c"># pass on callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<h3 id="msg-json-keys"><code class="prettyprint">msg</code> JSON keys</h3>

<table><thead>
<tr>
<th style="text-align: left">key</th>
<th>details</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">input</td>
<td>input to the target module function.</td>
</tr>
<tr>
<td style="text-align: left">to</td>
<td>filename of the target module in <code class="prettyprint">lib/&lt;lang&gt;</code>.</td>
</tr>
<tr>
<td style="text-align: left">intent</td>
<td>function of the target module to call. Call nested function with dot-path, e.g. <code class="prettyprint">nlp.translate</code>.</td>
</tr>
<tr>
<td style="text-align: left">output</td>
<td>output from the target function to reply with.</td>
</tr>
<tr>
<td style="text-align: left">from</td>
<td>ID of the script sending the <code class="prettyprint">msg</code>.</td>
</tr>
<tr>
<td style="text-align: left">hash</td>
<td>auto-generated callback-promise hash from <code class="prettyprint">client.js</code> to callback interface.</td>
</tr>
</tbody></table>

<p>Of course, add additional keys to the JSON as needed by your function.</p>

<aside class="notice">
Overall, ensure that your functions return the correct JSON `msg`, and we handle the inter-language dataflow logic.
</aside>

<aside class="success">
Socket.io can send deeply nested JSON with standard data type.
</aside>

<h3 id="server">Server</h3>

<p>There is a socket.io server that extends Hubot&rsquo;s Express.js server: <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/io_server.js" target="_blank"><code>lib/io_server.js</code></a>. All <code class="prettyprint">msg</code>s go through it. For example, let <code class="prettyprint">msg.to = &#39;hello.py&#39;, msg.intent = &#39;sayHi&#39;</code>. The server splits this into <code class="prettyprint">module = &#39;hello&#39;, lang = &#39;py&#39;</code>, modifies <code class="prettyprint">msg.to = module</code>, then sends the <code class="prettyprint">msg</code> to the client of <code class="prettyprint">lang</code>.</p>

<blockquote>
<p>For quick multilingual dev, you can start the <strong>polyglot server</strong> at <code class="prettyprint">lib/io_start</code>.</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># shell: start the polyglot server</span>
node lib/io_start.js
</code></pre>

<aside class="warning">
This is automatically with <code>npm run</code>, so don&rsquo;t manual-run it before starting the bot.
</aside>

<h3 id="clients"><a name="clients"></a>Clients</h3>

<p>For each language, there is a socket.io client that imports all modules of its language within <code class="prettyprint">lib</code>. When server sends a <code class="prettyprint">msg</code> to it, the client&rsquo;s <code class="prettyprint">handle</code> will find the module and its function using <code class="prettyprint">msg.to, msg.intent</code> respectively, then call the function with <code class="prettyprint">msg</code> as the argument. If it gets a valid reply <code class="prettyprint">msg</code>, it will pass it on to the server.</p>

<blockquote>
<p>then import a <code class="prettyprint">lib/client.js</code> to test a local feature from the <code class="prettyprint">js</code> interface. Example: quickly testing the translate function in <code class="prettyprint">python</code>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: interface scripts</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="s2">"hola amigos"</span><span class="p">,</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'ai.py'</span><span class="p">,</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'nlp.translate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// hello friends</span>
</code></pre>

<blockquote>
<p>Note due to how a module is called using <code class="prettyprint">msg.to, msg.intent</code>, you must ensure that the functions are named properly, and <code class="prettyprint">Ruby</code>&rsquo;s requirement that module be capitalized implies that you have to name the file with the same capitalization, e.g. <code class="prettyprint">lib/rb/Hello.rb</code> for the <code class="prettyprint">Hello</code> module.</p>
</blockquote>

<p>We now support <code class="prettyprint">node.js, python, ruby</code>.</p>

<aside class="notice">
To add support for other language, say Java, you can add a <code>lib/client.java</code> by following patterns in <code>lib/client.{py, rb}</code>, and starting them in <code>lib/io_client.js</code>. Please create a pull request if you do so :)
</aside>

<h3 id="entry-point">Entry point</h3>

<p>The entry point is always a <code class="prettyprint">js</code> interface script, but luckily we have made it trivial for non-js developers to write it. A full reference is <a href="https://github.com/github/hubot/blob/master/docs/scripting.md">hubot scripting guide</a>.</p>

<p><code class="prettyprint">robot.respond</code> takes a regex and a callback function, which executes when the regex matches the string the robot receives. <code class="prettyprint">res.send</code> is the primary method we use to send a string to the user.</p>

<p>Overall, there are 2 ways to connect with <code class="prettyprint">lib</code> modules:</p>

<p><strong>global.gPass</strong>: <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a> This is a global method to pass a <code class="prettyprint">msg</code>. It generates a <code class="prettyprint">hash</code> using <code class="prettyprint">lib/hasher.js</code> with a <code class="prettyprint">Promise</code>, which is resolved whenever the <code class="prettyprint">js</code> client receives a valid reply <code class="prettyprint">msg</code> with same <code class="prettyprint">hash</code>. This method returns the resolved <code class="prettyprint">Promise</code> with that <code class="prettyprint">msg</code> for chaining.</p>

<p><strong>wrapped global.gPass</strong>: <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/translate.js" target="_blank"><code>scripts/translate.js</code></a>, <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/js/nlp.js" target="_blank"><code>lib/js/nlp.js</code></a> This is similar to above, but the <code class="prettyprint">msg</code> is properly generated by a <code class="prettyprint">js</code> lib module, resulting in a much cleaner and safer interface script. The lib module needs to be imported at the top to be used.</p>

<h3 id="data-flow">Data flow</h3>

<p>The msg goes through socket.io as </p>

<ul>
<li><code class="prettyprint">js(interface script)</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; &lt;lang&gt;(client.&lt;lang&gt;)</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; ...(can bound among different &lt;lang&gt; modules)</code></li>
<li><code class="prettyprint">-&gt; js(client.js)</code></li>
<li><code class="prettyprint">-&gt; js(interface script)</code></li>
</ul>

<p>For the <code class="prettyprint">hello_py.js</code> example, the path is </p>

<ul>
<li><code class="prettyprint">js(scripts/hello_py.js) user input</code></li>
<li><code class="prettyprint">-&gt; js(lib/io_server.js)</code></li>
<li><code class="prettyprint">-&gt; py(client.py), call py function</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; js(client.js) call Promise.resolve</code></li>
<li><code class="prettyprint">-&gt; js(interface script) send back to user</code></li>
</ul>

<h2 id="project-directory-structure"><a name="project-dir"></a>Project directory structure</h2>

<p>What goes where:</p>

<table><thead>
<tr>
<th style="text-align: left">Folder/File</th>
<th>Purpose</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">bin/</td>
<td>bot keys, binaries, bash setup scripts.</td>
</tr>
<tr>
<td style="text-align: left">lib/&lt;lang&gt;/</td>
<td>Module scripts, grouped by language, callable via socket.io. See <a href="#polyglot-dev">Polyglot Development</a>.</td>
</tr>
<tr>
<td style="text-align: left">lib/client.&lt;lang&gt;</td>
<td>Import all scripts from <code class="prettyprint">lib/&lt;lang&gt;/</code> and expose them to socket.io for cross-language communication.</td>
</tr>
<tr>
<td style="text-align: left">lib/io_start.js</td>
<td>socket.io server and client logic for cross-language communication.</td>
</tr>
<tr>
<td style="text-align: left">logs</td>
<td>Logs from bot for debugging and healthcheck.</td>
</tr>
<tr>
<td style="text-align: left">scripts</td>
<td>The <code class="prettyprint">node.js</code> user interface for the <code class="prettyprint">lib/</code> modules.</td>
</tr>
<tr>
<td style="text-align: left">scripts/_init.js</td>
<td>Kicks off AIVA setups after the base Hubot is constructed, before other scripts are lodaded.</td>
</tr>
<tr>
<td style="text-align: left">test</td>
<td>Unit tests; uses Mocha.</td>
</tr>
<tr>
<td style="text-align: left">.env</td>
<td>Non-bot-specific environment variables.</td>
</tr>
<tr>
<td style="text-align: left">external-scripts.json</td>
<td>You can <a href="https://github.com/github/hubot/blob/master/docs/scripting.md#script-loading">load Hubot npm modules</a> by specifying them in here and <code class="prettyprint">package.json</code>.</td>
</tr>
</tbody></table>

<h2 id="what-to-use-for-what">What to use for what</h2>

<p>Some of the best/recommended libraries for things:</p>

<ul>
<li><strong>NLP</strong>: SpaCy(python), TextBlob(py), Natural(js), StanfordNLP(java), Watson, Indico.io, Wordnet</li>
<li><strong>Machine learning</strong>: scikit-learn(py), pandas(py), skflow(py), Google APIs</li>
<li><strong>Deep learning</strong>: Tensorflow(py), Skflow(py), Torch(lua), Theano(py), leaf(rust) , deeplearning4j(java)</li>
<li><strong>Knowledge/concept base</strong>: ConceptNet, Wordnet, Google graph</li>
<li>Whatever you do best in your favorite languages</li>
</ul>

          <h1 id="features"><a name="features"></a>Features</h1>

<p>This gives a top level overview of the features. See <a href="#modules">Modules</a> to find usable functions for developers.</p>

<table><thead>
<tr>
<th style="text-align: left">Feature</th>
<th>Implemented?</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="#setup2">fast setup</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#cross-platform">cross-platform</a></td>
<td>implementing</td>
</tr>
<tr>
<td style="text-align: left"><a href="#graph-brain">graph brain</a></td>
<td>improving</td>
</tr>
<tr>
<td style="text-align: left"><a href="#multi-language">multi-language</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#builtin-ai">built-in AI tools</a></td>
<td>yes</td>
</tr>
</tbody></table>

<h2 id="fast-setup"><a name="setup2"></a>fast setup</h2>

<p><a href="#setup">3 steps</a> to get a bot installed and running. It once took me just 15 seconds to deploy a bot for an unexpected demo. </p>

<p><em>P/S &ldquo;fast&rdquo; implies the least number of steps; dependency installation can be heavy and long.</em></p>

<h2 id="cross-platform"><a name="cross-platform"></a>cross-platform</h2>

<p>The Facebook bot paradigm is &ldquo;why use multiple apps when you can access them from one bot?&rdquo;. I dare to ask &ldquo;why talk to the bot from one platform instead of everywhere?&rdquo;</p>

<h3 id="omnipresence">Omnipresence</h3>

<p>This inspires the <em>omnipresence</em> feature: a bot that recognizes who you are, and can continue conversation in any supported platforms. We talk to our friends everywhere, and they don&rsquo;t forget us when we switch apps. Bots should do the same too.</p>

<p>In short: <em>one brain, multiple interfaces</em>. AIVA&rsquo;s hubot base allows for generality, and she can tap into multiple platforms by using different <a href="#adapters">adapters</a>. Unlike the original hubot though, she can exist simultaneously on multiple platforms by having several interface instances plugged into the respective adapters, and all share the same brain, which serves as the central memory.</p>

<p>For the list of supported adapters see <a href="#adapters">adapters</a>.</p>

<h2 id="graph-brain"><a name="graph-brain"></a>graph brain</h2>

<p>Graph is a very generic and natural way of encoding information, especially for information that doesn&rsquo;t always follow a fixed schema. A knowledge base is often implemented as a graph (wordNet, conceptNet, google graph, facebook graph, etc.)</p>

<p>Although graph and non-graph databases can both be Turing-complete, graphs tend to have a lower working complexity in practice. Turing completeness ensures that the database can do everything a computer supposedly can; lower complexity makes development easier.</p>

<p>AIVA uses <a href="https://github.com/kengz/neo4jKB"><code class="prettyprint">neo4jKB</code></a> as the brain - a knowledge base implemented graph with <a href="http://neo4j.com"><code class="prettyprint">neo4j</code></a>. Specifically, <code class="prettyprint">neo4jKB</code> imposes a <a href="https://github.com/kengz/neo4jKB#kb-standard-basic">KB standard</a> on the graph for proper usage as a knowledge base.</p>

<aside class="notice">
Neo4jKB is a completed project. Currently it is used for user-recognition and user todo list. AIVA doesn&rsquo;t fully utilize Neo4jKB yet as the AI tools are under development. When done, AIVA will be able to automatically form and extract knowledge from the graph brain.
</aside>

<h2 id="multi-language"><a name="multi-language"></a>multi-language</h2>

<p><strong>Unite we stand</strong>. When different languages work together, we can access a much larger set of development tools. Also, we wish that a developer can use the AIVA regardless of his/her favorite programming language. </p>

<p>For more, see <a href="#polyglot">Polyglot environment</a> and <a href="#clients">Socket.io clients</a> for how it&rsquo;s done. We now support <code class="prettyprint">node.js, python, ruby</code>.</p>

<h2 id="built-in-ai-tools"><a name="builtin-ai"></a>built-in AI tools</h2>

<p>AIVA comes with a well-rounded set of AI/machine learning tools. We have packaged these tools nicely, so you can get right into work with them. This saves you the tideous hunt, installation, and setup. </p>

<p><code class="prettyprint">lib/&lt;lang&gt;/ais/</code> contains the specific implementations of the AI modules/models, and <code class="prettyprint">lib/&lt;lang&gt;/ai.&lt;lang&gt;</code> is the high-level script that imports the functions from <code class="prettyprint">lib/&lt;lang&gt;/ais/</code> for usage.</p>

<p>Thanks to the multi-language feature, we can easily access the machine learning universe of Python. For example, <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/ais/" target="_blank"><code>lib/py/ais/</code></a> contains a sample Tensorflow training script <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/ais/dnn_titanic_train.py" target="_blank"><code>dnn_titanic_train.py</code></a>, and a script to deploy that DNN for usage <a href="https://github.com/kengz/aiva/tree/aiva-v3/lib/py/ais/dnn_titanic_deploy.py" target="_blank"><code>dnn_titanic_deploy.py</code></a>. It is interfaced through <a href="https://github.com/kengz/aiva/tree/aiva-v3/scripts/dnn_titanic.js" target="_blank"><code>scripts/dnn_titanic.js</code></a> that allows you to use run predictions.</p>

<p>The list of AI modules and their respective language:</p>

<table><thead>
<tr>
<th style="text-align: left">AI/ML</th>
<th>type</th>
<th>lang</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="https://www.tensorflow.org">Tensorflow</a></td>
<td>Neural Nets</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="http://scikit-learn.org/stable/">skflow (scikit-learn)</a></td>
<td>Generic ML algorithms</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://spacy.io">spaCy</a></td>
<td>NLP</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://indico.io">Indico.io</a></td>
<td>text+image analysis</td>
<td>(REST API) Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="http://www.ibm.com/cloud-computing/bluemix/watson/">IBM Watson</a></td>
<td>cognitive computing</td>
<td>Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://console.developers.google.com/apis">Google API</a></td>
<td>multiple</td>
<td>Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/Planeshifter/node-concept-net">ConceptNet</a></td>
<td>semantic network</td>
<td>(REST API) Node.js interface</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/NaturalNode/natural">NodeNatural</a></td>
<td>NLP</td>
<td>Node.js</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/moos/wordpos">wordpos</a></td>
<td>WordNet POS</td>
<td>Node.js</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/matthewmueller/date">date.js</a></td>
<td>time-parsing</td>
<td>Node.js</td>
</tr>
</tbody></table>

<p>These tools are put close together in a <a href="#polyglot">polyglot environment</a>, so you can start combining them in brand new ways. An example is the generic NLP parser <a href="https://github.com/kengz/aiva/blob/aiva-v3/lib/js/gen_nlp.js" target="_blank"><code>lib/js/gen_nlp.js</code></a> for parsing user input into intent and functional arguments - it uses <code class="prettyprint">date.js</code> and <code class="prettyprint">spaCy</code>.</p>

<p>For more in-depth details, see <a href="#modules">modules</a>. Also if find a great ML tool we should include, submit a Pull Request!</p>

          <h1 id="modules"><a name="modules"></a>Modules</h1>

<table><thead>
<tr>
<th style="text-align: left">Module</th>
<th>Implemented?</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="#gen_nlp">general NLP</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#tensorflow">tensorflow</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#indico">Indico.io</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#kbase">Knowledge base</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#google-api">google APIs</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#custom-msg">general customMsg</a></td>
<td>pending</td>
</tr>
<tr>
<td style="text-align: left"><a href="#neo4jKB-brain">neo4jKB brain</a></td>
<td>pending</td>
</tr>
</tbody></table>

<p>misc list of all functions and modules in all lang that come in the box. Need programmatic way to generate such a list, ohh maybe during client start?</p>

<h2 id="general-nlp"><a name="gen_nlp"></a>general NLP</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">genNLP</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../lib/js/gen_nlp'</span><span class="p">)</span>

<span class="nx">s</span> <span class="o">=</span> <span class="s1">'find me flights from New York to London at 9pm tomorrow.'</span>
<span class="nx">genNLP</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">))</span>
<span class="p">})</span>
</code></pre>

<p>We provide a fast NLP module in <code class="prettyprint">lib/js/gen_nlp</code> for generic usage. It serves as a convenient method to get all the vital NLP parsed results. This is especially useful in the <code class="prettyprint">js</code> <strong>interface</strong> scripts for <em>parsing user inputs, normalizing texts, and extracting information</em>.</p>

<blockquote>
<p>This will yield the result pulled from spaCy in Python, and Date.js in Node.js.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"len"</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="s2">"pos_fine"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"PRP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NNS"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"York"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9"</span><span class="p">,</span> <span class="s2">"CD"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"NN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"."</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9pm"</span><span class="p">,</span> <span class="s2">"TIME"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"lemmas"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"me"</span><span class="p">,</span> <span class="s2">"flight"</span><span class="p">,</span> <span class="s2">"from"</span><span class="p">,</span> <span class="s2">"new"</span><span class="p">,</span> <span class="s2">"york"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"london"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">,</span> <span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"."</span><span class="p">],</span>
  <span class="s2">"tokens"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"me"</span><span class="p">,</span> <span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"from"</span><span class="p">,</span> <span class="s2">"New"</span><span class="p">,</span> <span class="s2">"York"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"London"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">,</span> <span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"."</span><span class="p">],</span>
  <span class="s2">"pos_coarse"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VERB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"York"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9"</span><span class="p">,</span> <span class="s2">"NUM"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"PUNCT"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER_POS_tag"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VERB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9pm"</span><span class="p">,</span> <span class="s2">"TIME"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"PUNCT"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER_POS_tree"</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">"find"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s2">"flights"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">"me"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"nsubj"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"from"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"New York"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"GPE"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"to"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"London"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"GPE"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"at"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"9pm"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"TIME"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"tomorrow"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"npadvmod"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
            <span class="p">}</span>
          <span class="p">}],</span>
          <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"ccomp"</span><span class="p">,</span>
          <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s2">"."</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"punct"</span><span class="p">,</span>
          <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"PUNCT"</span>
        <span class="p">}</span>
      <span class="p">}],</span>
      <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"ROOT"</span><span class="p">,</span>
      <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"VERB"</span>
    <span class="p">}</span>
  <span class="p">}],</span>
  <span class="s2">"noun_phrases"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"London"</span><span class="p">,</span> <span class="s2">"9pm"</span><span class="p">],</span>
  <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"find me flights from New York to London at 9 pm tomorrow ."</span><span class="p">,</span>
  <span class="s2">"time"</span><span class="p">:</span> <span class="s2">"2016-04-24T01:00:00.042Z"</span>
<span class="p">}</span>
</code></pre>

<table><thead>
<tr>
<th style="text-align: left">NLP property</th>
<th>Details</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">text</td>
<td>The original input text.</td>
</tr>
<tr>
<td style="text-align: left">len</td>
<td>Length: number of tokens in text.</td>
</tr>
<tr>
<td style="text-align: left">tokens</td>
<td>Text broken into array of tokens.</td>
</tr>
<tr>
<td style="text-align: left">lemmas</td>
<td>The <a href="https://en.wikipedia.org/wiki/Lemmatisation">base form</a> of each token.</td>
</tr>
<tr>
<td style="text-align: left">NER</td>
<td><a href="https://en.wikipedia.org/wiki/Named-entity_recognition">Named Entity Recognition</a></td>
</tr>
<tr>
<td style="text-align: left">noun_phrases</td>
<td>grouping of meaningful nouns</td>
</tr>
<tr>
<td style="text-align: left">pos_coarse</td>
<td><a href="https://spacy.io/docs#token-postags">Coarse</a> Part-of-speech tagging.</td>
</tr>
<tr>
<td style="text-align: left">pos_fine</td>
<td><a href="https://spacy.io/docs#token-postags">Finer</a> Part-of-speech tagging.</td>
</tr>
<tr>
<td style="text-align: left">NER_POS_tree</td>
<td>The syntactic and dependency parse tree of text, seen in <a href="https://spacy.io/demos/displacy">DisplaCy</a></td>
</tr>
<tr>
<td style="text-align: left">NER_POS_tag</td>
<td>The flatten array of NER_POS_tree, without the dependencies.</td>
</tr>
<tr>
<td style="text-align: left">time</td>
<td>Parsed time if any, as ISO time string.</td>
</tr>
</tbody></table>

<p>Example app that uses this.</p>

          <h1 id="setup-tips"><a name="setup-tips"></a>Setup tips</h1>

<h2 id="setup-script">Setup script</h2>

<p><code class="prettyprint">npm run gi</code> runs the following in sequence:</p>

<ul>
<li>the shell setup script in <a href="https://github.com/kengz/aiva/tree/aiva-v3/bin/install" target="_blank"><code>bin/install</code></a></li>
<li><code class="prettyprint">npm install</code></li>
<li><code class="prettyprint">pip3 install -r requirements.txt</code></li>
<li><code class="prettyprint">bundle install</code></li>
</ul>

<p>It&rsquo;s save to run the multiple times; they&rsquo;ll just update. The shell install script is necessary because &hellip; just look at how many things get installed there.</p>

<h2 id="custom-deployment">Custom deployment</h2>

<p>All bot deployment commands are wrapped with <code class="prettyprint">npm</code> inside <code class="prettyprint">package.json</code>. For more novice users, you can customize the <code class="prettyprint">scripts</code> in <code class="prettyprint">package.json</code>. For example, changing &ldquo;aiva&rdquo; and &ldquo;aivadev&rdquo; to your bot name of choice.</p>

<h2 id="monitoring">Monitoring</h2>

<p>AIVA uses <a href="https://github.com/foreverjs/forever"><code class="prettyprint">forever</code></a> to keep-alive (with 10 max restarts). <code class="prettyprint">npm start</code> runs the process in the background, with it stdout logs written to <code class="prettyprint">/logs</code>. <code class="prettyprint">npm run debug</code> runs the same thing except it logs stdout to the terminal.</p>

<h2 id="neo4j">Neo4j</h2>

<p>If it&rsquo;s your first installation of <code class="prettyprint">Neo4j</code>, change the password:</p>
<pre class="highlight shell"><code>neo4j start
<span class="c"># change your password</span>
<span class="c"># note the default username:pswd is neo4j:neo4j</span>
curl -X POST -d <span class="s2">"password=YOUR_NEW_PASSWORD"</span> -u neo4j:&lt;OLD_PSWD&gt; http://localhost:7474/user/neo4j/password
<span class="c"># access Neo4j browser GUI</span>
open http://localhost:7474
</code></pre>

<h2 id="ssh-browser-forwarding">SSH Browser-forwarding</h2>

<p>If you&rsquo;re hosting Neo4j on a remote machine and want to access its browser GUI on your local machine, connect to it via </p>
<pre class="highlight shell"><code>ssh -L 8080:localhost:7474 &lt;remote_host&gt;
</code></pre>

<p>Then you can go to <code class="prettyprint">http://localhost:8080/</code> on your local browser.</p>

<h2 id="dependencies"><a name="dependencies"></a>Dependencies</h2>

<p>All the system dependencies are installed automatically by running <code class="prettyprint">npm run gi</code>, which executes <a href="https://github.com/kengz/aiva/tree/aiva-v3/bin/install" target="_blank"><code>bin/install</code></a>. If you&rsquo;d like to setup your VM manually, see/edit the setup script; below is the (non-exhaustive) list:</p>

<ul>
<li><code class="prettyprint">node.js &gt;v5.x</code></li>
<li><code class="prettyprint">java jdk &gt;7, export $JAVA_HOME path</code></li>
<li><code class="prettyprint">neo4j &gt;v2.3.0</code></li>
<li><code class="prettyprint">neo4j shell tool</code></li>
<li><code class="prettyprint">python3, pip3</code></li>
<li><code class="prettyprint">setuptools virtualenvwrapper</code> (<code class="prettyprint">pip3</code>)</li>
<li><code class="prettyprint">libatlas-dev libblas-dev gfortran</code> (<code class="prettyprint">Linux apt-get</code>)</li>
<li><code class="prettyprint">numpy scipy tensorflow scikit-learn skflow pandas matplotlib</code> (<code class="prettyprint">pip3</code>)</li>
<li><code class="prettyprint">ruby, bundler</code></li>
<li><code class="prettyprint">forever, istanbul</code> (<code class="prettyprint">npm -g</code>)</li>
</ul>

          <h1 id="adapters"><a name="adapters"></a>Adapters</h1>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
